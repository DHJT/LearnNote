# microservice
<!-- @author DHJT 2019-01-29 -->

## 什么样的项目适合微服务
微服务可以按照业务功能本身的独立性来划分，如果系统提供的业务是非常底层的，如：操作系统内核、存储系统、网络系统、数据库系统等等，这类系统都偏底层，功能和功能之间有着紧密的配合关系，如果强制拆分为较小的服务单元，会让集成工作量急剧上升，并且这种人为的切割无法带来业务上的真正的隔离，所以无法做到独立部署和运行，也就不适合做成微服务了。

能不能做成微服务，取决于四个要素：

- 小：微服务体积小，2 pizza 团队。
- 独：能够独立的部署和运行。
- 轻：使用轻量级的通信机制和架构。
- 松：为服务之间是松耦合的。

Microservice架构模式就是将整个Web应用组织为一系列小的Web服务。这些小的Web服务可以独立地编译及部署，并通过各自暴露的API接口相互通讯。它们彼此相互协作，作为一个整体为用户提供功能，却可以独立地进行扩。

### 微服务架构需要的功能或使用场景
1. 我们把整个系统根据业务拆分成几个子系统。
2. 每个子系统可以部署多个应用，多个应用之间使用负载均衡。
3. 需要一个服务注册中心，所有的服务都在注册中心注册，负载均衡也是通过在注册中心注册的服务来使用一定策略来实现。
4. 所有的客户端都通过同一个网关地址访问后台的服务，通过路由配置，网关来判断一个URL请求由哪个服务处理。请求转发到服务上的时候也使负载均衡。
5. 服务之间有时候也需要相互访问。例如有一个用户模块，其他服务在处理一些业务的时候，要获取用户服务的用户数据。
6. 需要一个断路器，及时处理服务调用时的超时和错误，防止由于其中一个服务的问题而导致整体系统的瘫痪。
7. 还需要一个监控功能，监控每个服务调用花费的时间等。

- 目前主流的微服务框架：Dubbo、SpringCloud、thrift、Hessian等。
- SpringBoot:旨在简化创建产品级的Spring应用和服务，简化了配置文件，使用嵌入式web服务器，含有诸多开箱即用微服务功能，可以和spring cloud联合部署。
- SpringCloud：微服务工具包，为开发者提供了在分布式系统的配置管理、服务发现、断路器、智能路由、微代理、控制总线等开发工具包。

Nacos 致力于帮助您发现、配置和管理微服务

Spring Cloud：http://projects.spring.io/spring-cloud（现在非常流行的微服务架构）
Dubbo：http：//dubbo.io
Dropwizard：http://www.dropwizard.io （关注单个微服务的开发）
Consul、etcd&etc.（微服务的模块）

服务链路追踪:`Spring Cloud Sleuth`(Zipkin/PinPoint)
- 链路追踪组件有Google的`Dapper`，Twitter 的`Zipkin`，以及阿里的`Eagleeye`（鹰眼）Skywalking
- APM（ApplicationPerformance Management）

|       模块       |                          组件                         |
|------------------|-------------------------------------------------------|
| 配置中心         | Apollo、`SpringCloud Config`                          |
| 网关             | Eureka、`SpringCloud Getaway`/Consul,ZK               |
| 服务链路追踪     | `Spring Cloud Sleuth`(Zipkin/PinPoint)                |
| 客户端软负载均衡 | `Ribbon`、`spring-cloud-loadbalancer`                 |
| 熔断器           | Hystrix、spring-cloud-r4j(Resilience4J)，阿里Sentinel |


配置管理
服务注册与发现
断路器
智能路由
服务间调用
负载均衡
微代理控制
总线
一次性令牌
全局锁
领导选举
分布式会话
集群状态
分布式消息
...

### 微服务架构的六种模式[^1]
1. 聚合器微服务设计模式
2. 代理微服务设计模式
3. 链式微服务设计模式
4. 分支微服务设计模式
5. 数据共享微服务设计模式
6. 异步消息传递微服务设计模式
[^1]: [微服务架构的六种模式](https://cloud.tencent.com/developer/article/1458881)