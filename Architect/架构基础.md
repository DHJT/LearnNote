# 架构基础
<!-- @author DHJT 2020-05-14 -->
《大型网站技术架构:核心原理与案例分析》

并行和并发区别

1、并行是指两者同时执行一件事，比如赛跑，两个人都在不停的往前跑；
2、并发是指资源有限的情况下，两者交替轮流使用资源，比如一段路(单核CPU资源)同时只能过一个人，A走一段后，让给B，B用完继续给A ，交替使用，目的是提高效率

## 软件架构技术

### 多租户技术(multi-tenancy technology)
或称多重租赁技术，是一种软件架构技术，它是在探讨与实现如何于多用户的环境下共用相同的系统或程序组件，并且仍可确保各用户间数据的隔离性。
多租户简单来说是指一个单独的实例可以为多个组织服务。多租户技术为共用的数据中心内如何以单一系统架构与服务提供多数客户端相同甚至可定制化的服务，并且仍然可以保障客户的数据隔离。一个支持多租户技术的系统需要在设计上对它的数据和配置进行虚拟分区，从而使系统的每个租户或称组织都能够使用一个单独的系统实例，并且每个租户都可以根据自己的需求对租用的系统实例进行个性化配置。
多租户技术可以实现多个租户之间共享系统实例，同时又可以实现租户的系统实例的个性化定制。通过使用多租户技术可以保证系统共性的部分被共享，个性的部分被单独隔离。通过在多个租户之间的资源复用，运营管理维护资源，有效节省开发应用的成本。而且，在租户之间共享应用程序的单个实例，可以实现当应用程序升级时，所有租户可以同时升级。同时，因为多个租户共享一份系统的核心代码，因此当系统升级时，只需要升级相同的核心代码即可。
目的：共用相同的系统或程序组件
要求：确保各用户间数据的隔离性


### 测试之stub和mock
Mock Stub（打桩）

Mock
关注行为验证。细粒度的测试，即代码的逻辑，多数情况下用于单元测试。

Stub
关注状态验证。粗粒度的测试，在某个依赖系统不存在或者还没实现或者难以测试的情况下使用，例如访问文件系统，数据库连接，远程协议等。

Stub和Mock的相同处
stub和mock都是为了配合测试，对被测程序所依赖的单元的模拟。
简单说，为了测函数A，但A有引用到了函数B，通过模拟B的一些状态或行为测试A。
Stub和Mock都是模拟外部依赖，以便我们能控制。

Stub和Mock的区别
stub基于状态，mock基于行为
stub难于维护
mock有对本身的调用验证
stub是基于状态，mock是基于行为。
Stub是完全模拟一个外部依赖， 而Mock用来判断测试通过还是失败

Mock与Stub的区别

Mock:
关注行为验证。细粒度的测试，即代码的逻辑，多数情况下用于单元测试。

何时使用Mock：
真实对象的行为具有不确定性。
真实对象难以创建。
真实对象的行为难以模拟(例如网络错误)。
真实对象运行效率很低。
真实对象有或者是UI。
测试需要得到某个对象列表，但是真实对象必须在某种环境下才能提供。
真实对象还没实现。
Mock的优点：
运行速度快，测试覆盖率高，容易实现且可以形成良好的测试文档。
Mock的缺点：
不是银弹，对于集成测试等粗粒度且耗时的测试不太适用。
Stub：
关注状态验证。粗粒度的测试，在某个依赖系统不存在或者还没实现或者难以测试的情况下使用，例如访问文件系统，数据库连接，远程协议等。

何时用Stub：
需要用到Mock或者Stub的情况，往往是测试的代码存在依赖，当这种依赖难以实现或者不稳定的时候可以考虑使用Stub策略，例如，需要测试的系统，可能需要访问数据库，依赖于运行环境(安全性，存储，Web Service)，或者需要访问远程文件系统，访问远程协议(HTTP，SOAP)等。

由于现存的应用的太复杂或者过于脆弱，修改它需要大量的人天。诸如不同系统之间的集成测试，类属于粗粒度的测试皆可考虑使用Stub。

Stub的优点：
能弥补Mock的不足，能够模拟复杂的测试环境。
Stub的缺点：
Stub往往比较复杂难以实现，而且需要经常性的调试它。
由于Stub模拟的都是难以测试的环境依赖，其复杂性导致它难以维护。
实现Stub并不能提供细粒度的单元测试。
不同的情况需要不同的Stub实现策略。